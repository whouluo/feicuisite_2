!function(e){function i(e,i){Mobi.ing(e,i)}function t(){return"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)}e.fn.uploadify=function(l){var n={fileTypeExts:"",uploader:"",auto:!1,method:"post",multi:!1,formData:{},fileObjName:"filedata",fileSizeLimit:2048,showUploadedPercent:!0,showUploadedSize:!1,buttonText:"",isDefinedButton:!1,isOrnotButton:!1,removeTimeout:1e3,itemTemplate:'<div id="${fileID}" class="uploadify-queue-item "><div class="uploadify-progress"><div class="uploadify-progress-bar"></div></div><span class="up_filename">${fileName}</span><span class="uploadbtn">上传</span><span class="delfilebtn">删除</span></div>',breakPoints:!1,isBurst:!0,fileSplitSize:1048576,getFileSizeUrl:"",getFileSizeUrlFlag:!0,view_progress:null,showDefalutUploadProgress:!0,getUploadedSize:function(t){if(o.getFileSizeUrlFlag){var l=0;return e.ajax({url:o.getFileSizeUrl,async:!1,type:"post",dataType:"json",data:{fileMd5:t.md5,fileSplitSize:o.fileSplitSize,fileName:t.name,totalSize:t.size},success:function(e){e.success?l=e.size:(l=-1,i(e.msg))}}),l}},saveUploadedSize:null,saveInfoLocal:!1,onUploadStart:null,onUploadSuccess:null,onUploadComplete:null,onUploadError:null,onInit:null,onCancel:null,onSelect:null},o=e.extend(n,l),a=function(e){for(var i=[],t=e.split(";"),l=0,n=t.length;l<n;l++)i.unshift(t[l].split(".").pop());return i},s={img:["image/*"],zip:["application/x-zip-compressed"],doc:["application/msword"],xls:["application/vnd.ms-excel"],docx:["application/vnd.openxmlformats-officedocument.wordprocessingml.document"],xlsx:["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],ppt:["application/vnd.ms-powerpoint"],pptx:["application/vnd.openxmlformats-officedocument.presentationml.presentation"],mp3:["audio/mp3"],mp4:["video/mp4"],pdf:["application/pdf"],exe:["application/x-msdownload"],html:["text/html"],ico:["image/x-icon"],txt:["text/plain"],flv:[".flv"],swf:["application/x-shockwave-flash"],jpg:["image/jpg"],jpeg:["image/jpeg"],png:["image/png"],gif:["image/gif"],bmp:["image/bmp"],xml:["application/vnd.ms-excel"],bin:["application/octet-stream"],js:["application/x-javascript"],css:["text/css"],cer:["application/x-x509-ca-cert"]},r=function(e){return s[e]},d=function(e){for(var i=a(e),l=[],n=[],o=!1,d=0,p=i.length;d<p;d++){var f=r(i[d]);f&&l.push(f)}if(l.length>0){for(var u=0;u<l.length;u++)-1==l[u][0].indexOf("image")?n.push(l[u]):o=!0;o&&n.unshift(s.img)}return!Fai.top._manageMode&&t()&&function(){var e=window.navigator.userAgent.toLowerCase();return["mx4 pro"].some(function(i){return e.indexOf(i)>-1})}()?n.join(","):l.join(",")},p=function(e,i,t,l){i.open(o.method,e,!0),i.setRequestHeader("X-Requested-With","XMLHttpRequest");var n=new FormData;if(n.append(o.fileObjName,t,t.name),l)for(var a in l)n.append(a,l[a]);i.send(n)},f=90;function u(i){if(o.showDefalutUploadProgress)if("start"==i.status){var t=['<div id="progressBody_'+i.id+'" class="bodyDisable"></div>','<div id="progressWrap_'+i.id+'" class="bodyProgressWrap">','<div class="progressCenter"></div>','<div class="progressIngBody">','<div id="progressTitle'+i.id+'" class="progressIngTitle">'+i.title+"</div>",'<div class="progressIngMission">','<div class="mission"><div id="progress'+i.id+'" class="progress" style="width:1%;"></div></div>','<div id="progressNum'+i.id+'" class="progressNum">0%</div>',"</div>",'<div class="progressInfo"><span class="progressFileSize">文件大小:'+Fai.parseFileSize(i.size)+'</span><a class="progressCancel" href="javascript:uploadCancel(\''+i.id+"');\">取消</a></div>","</div>","</div>"];e("body").append(t.join("")),f=90}else if("ing"==i.status){var l=i.percent;o.view_progress&&o.view_progress(l),e("#progressTitle"+i.id).text(i.title);var n=c.fileFilter[0].name,s=a(n)[0].toLowerCase(),d=null==r(s)?"":r(s)[0];if(i.percent>f&&100!=i.percent){var p=Math.random()/5;f+=parseFloat(p.toFixed(2)),l=f=parseFloat(f.toFixed(2))}d.indexOf("image")>=0?(e("#progress"+i.id).css("width",l+"%"),e("#progressNum"+i.id).html(l+"%")):(e("#progress"+i.id).css("width",i.percent+"%"),e("#progressNum"+i.id).html(i.percent+"%")),e("#progress"+i.id).attr("width",i.percent),d.indexOf("image")>=0&&i.percent>99&&function i(t){if(90==f)return;f+=.5;if(f>100)return;f=parseFloat(f.toFixed(2));e("#progress"+t).css("width",f+"%");e("#progressNum"+t).html(f+"%");setTimeout(function(){i(t)},1e3)}(i.id)}else"end"==i.status?(e("#progressTitle"+i.id).text(i.title),e("#progressBody_"+i.id).remove(),e("#progressWrap_"+i.id).remove()):"error"==i.status&&e("#progress"+i.id).addClass("progressError")}var c=null;function m(e){var i=o.uploader;for(var t in e)i+="&"+t+"="+e[t];c.url=i}return this.each(function(){var l=e(this),n=e(".uploadify").length+1,s='<input id="select_btn_'+n+'" class="selectbtn" style="visibility: hidden;width: 0px;height: 0px;opacity: 0;" name="fileselect[]"';s+=o.multi?" multiple":"",s+=' accept="',null==o.fileTypeExts||""==o.fileTypeExts||"*"==o.fileTypeExts?s+="*.*":!Fai.top._manageMode&&t()?s+="*.*":s+=d(o.fileTypeExts),s+='" type="file"/>',o.isDefinedButton||(s+='<a id="file_upload_'+n+'-button" href="javascript:void(0)" class="uploadify-button uploadButton">',s+=o.buttonText,s+="</a>");l.append(s),(c={xhr:null,uploadAllowed:!0,fileInput:l.find(".selectbtn"),uploadFileList:e(document).find(".uploadify-queue"),url:o.uploader,fileFilter:[],uploadOver:!1,filter:function(t){var l=[],n=!1,s=a(o.fileTypeExts);if(""!=o.fileTypeExts&&"*.*"!=o.fileTypeExts&&null!=o.fileTypeExts&&-1==d(o.fileTypeExts).indexOf("image/*")||(n=!0),s.length>0)for(var r=0,p=t.length;r<p;r++){var f=t[r],u=o.rebuildFile;e.isFunction(u)&&(f=u(f));var c=o.fileNameLimit;if(!e.isFunction(c)||!c(f))if(f.size>o.fileSizeLimit)o.siteFree?i("免费版单个文件大小不超过"+o.fileSizeLimit/1024/1024+"MB，<a href='"+o.updateUrlViewRes+'\' target="_blank">点击了解各版本限制。</a>',!0):i("单个文件超过"+o.fileSizeLimit/1024/1024+"MB",!0);else{var m=f.name,g=m.indexOf("."),v="";-1!=g&&(v=m.substring(g+1)),o.siteFree&&"apk"==v?i("上传失败：您的版本目前不支持上传apk文件。",!0):n?l.push(f):e.inArray(f.name.split(".").pop().toLowerCase(),s)>=0?l.push(f):i("文件"+f.name+"类型不允许！",!0)}}return l},funSelect:function(e){if(!o.onSelect||o.onSelect(e)){if(o.breakPoints)var i=this.funGetUploadedSize(e[0]);if(-1!=i){var t=(i/e[0].size*100).toFixed(2),l={status:"start",id:e[0].id,title:"准备上传.....",percent:t,size:e[0].size};u(l),o.breakPoints&&(u(l={status:"ing",id:e[0].id,title:"正在上传.....",percent:t}),this.funUploadFile(e[0]))}}else c.fileFilter=[]},onProgress:function(i,t,l){var n=e("body").find("#progressWrap_"+i.id),a=t,s=n.attr("lastLoaded")||0;(t-=parseInt(s))<0&&(t=0);var r=e("#progress"+i.id),d=(t/l*100+(o.breakPoints?parseFloat(r.attr("width")||0):0)).toFixed(2);d=d>100?99.99:d,a<o.fileSplitSize?n.attr("lastLoaded",a):n.removeAttr("lastLoaded"),u({status:"ing",id:i.id,title:"正在上传.....",percent:d})},funGetProgressWidth:function(e){},funGetUploadedSize:function(e){return o.getUploadedSize?o.getUploadedSize(e):o.saveInfoLocal?parseInt(localStorage.getItem(e.name))||0:void 0},funSaveUploadedSize:function(e,i){o.saveUploadedSize?o.saveUploadedSize(e,i):o.saveInfoLocal&&localStorage.setItem(e.name,i)},funGetFiles:function(e){for(var i=e.target.files,t=0,l=(i=this.filter(i)).length;t<l;t++)this.fileFilter.push(i[t]);if(0!=this.fileFilter.length)return this.funDealFiles(i),this},funDealFiles:function(i){for(var t=e(document).find(".uploadify-queue .uploadify-queue-item").length,l=0,a=i.length;l<a;l++)i[l].index=++t,i[l].id="fileupload_"+n+"_"+i[l].index,i[l].md5=e.md5(i[l].name+i[l].size+i[l].type+i[l].lastModified+(new Date).getTime()),o.isBurst&&(i[l].size>=0&&i[l].size<20971520?o.fileSplitSize=5242880:i[l].size>=20971520&&i[l].size<52428800?o.fileSplitSize=5242880:i[l].size>=52428800&&i[l].size<104857600?o.fileSplitSize=8388608:i[l].size>=104857600&&i[l].size<524288e3?o.fileSplitSize=10485760:o.fileSplitSize=15728640);return this.funSelect(i),this},funDeleteFile:function(e){for(var i=0,t=this.fileFilter.length;i<t;i++){var l=this.fileFilter[i];if(l.index==e){o.breakPoints&&(this.uploadAllowed=!1),this.fileFilter.splice(i,1),c.fileInput.val(""),o.onCancel&&o.onCancel(l);break}}return this},funUploadFile:function(i){c.xhr=new XMLHttpRequest;var t=i,l=!1,a=e(document).find("#fileupload_"+n+"_"+i.index),s=function(){c.uploadOver&&(a.find(".uploadify-progress-bar").css("width","100%"),o.showUploadedSize&&a.find(".uploadedsize").text(a.find(".totalsize").text()),o.showUploadedPercent&&a.find(".up_percent").text("100%"),o.onUploadSuccess&&o.onUploadSuccess(t,c.xhr.responseText),c.funDeleteFile(i.index),setTimeout(r,1500))},r=function(){if(0!=c.fileFilter.length){var e=c.funGetUploadedSize(c.fileFilter[0])/c.fileFilter[0].size*100,i={status:"start",id:c.fileFilter[0].id,title:"准备上传.....",percent:e,size:c.fileFilter[0].size};u(i),u(i={status:"ing",id:c.fileFilter[0].id,title:"正在上传.....",percent:e}),c.funUploadFile(c.fileFilter[0])}};try{c.xhr=new XMLHttpRequest}catch(e){c.xhr=ActiveXobject("Msxml12.XMLHTTP")}if(o.breakPoints){var d=i.name,g=i.id,v=i.index,h=i.size,x=i.md5,S=parseInt(this.funGetUploadedSize(t));h>=o.fileSplitSize?(i=t.slice(S,S+o.fileSplitSize),l=!1,c.lastSplit=!1):(l=!0,c.lastSplit=!0),i.name=d,i.id=g,i.index=v,i.md5=x}c.xhr.upload&&!1!==S&&(c.xhr.upload.addEventListener("progress",function(e){c.onProgress(i,e.loaded,t.size),o.onUploadProgress&&o.onUploadProgress(e,i)},!1),c.xhr.onreadystatechange=function(){if(4==c.xhr.readyState){if(c.uploadOver=!0,200==c.xhr.status)if(JSON.parse(c.xhr.responseText).success)o.breakPoints?(S+=o.fileSplitSize,c.funSaveUploadedSize(t,S>=h?h:S),S<h?(c.uploadOver=!1,c.uploadAllowed&&(S+o.fileSplitSize>=h?(i=t.slice(S,h),l=!0):(i=t.slice(S,S+o.fileSplitSize),l=!1),i.name=d,i.id=g,i.index=v,i.size=h,o.formData.fileMd5=t.md5,o.formData.totalSize=t.size,o.formData.complete=l,o.formData.initSize=S,setTimeout(p(c.url,c.xhr,i,o.formData),2e3))):s()):s();else u({status:"end",id:i.id}),c.uploadOver=!0,s();else c.uploadOver&&o.onUploadError&&o.onUploadError(t,c.xhr.responseText);c.uploadOver&&(o.onUploadComplete&&o.onUploadComplete(t,c.xhr.responseText),c.fileInput.val(""),f=90)}},o.onUploadStart&&o.onUploadStart(i),o.formData.fileMd5=i.md5,o.formData.totalSize=t.size,o.formData.complete=l,o.formData.initSize=S,c.uploadAllowed=!0,m(o.post_params),p(c.url,c.xhr,i,o.formData))},init:function(){this.fileInput.length>0&&this.fileInput.change(function(e){c.funGetFiles(e)}),l.find(".uploadify-button").on("click",function(){l.find(".selectbtn")[0].click()}),o.onInit&&o.onInit()}}).init()}),Fai.parseFileSize=function(e){if(void 0!==e&&"number"==typeof e){var i;if(e<1024)i=e+"B";else if(e<1048576){i=(e/1024).toFixed(2)+"KB"}else{i=(e/1048576).toFixed(2)+"MB"}return i}return"-"},{genUploadUrl:m,fileObj:c,stop:function(){c.xhr.abort(),c.uploadOver=!1,c.uploadAllowed=!1;for(var e=0,i=c.fileFilter.length;e<i;e++)c.funDeleteFile(++e);c.fileFilter=[]},upload:function(e){if("*"===e){var i=i=c.fileFilter.length,t=0;for(i=c.fileFilter.length;t<i;t++)c.funUploadFile(c.fileFilter[t])}else{var l=function(e,i){for(var t=0;t<i.length;t++)if(i[t].index==e)return i[t];return!1}(e,c.fileFilter);l&&c.funUploadFile(l)}},cancel:function(e){for(var i=0,t=c.fileFilter.length;i<t;i++)c.funDeleteFile(++i)},disable:function(i){e(i?"file_upload_"+i+"-button":"body").find(".uploadify-button").css("background-color","#888").off("click")},ennable:function(i){var t=e(i?"file_upload_"+i+"-button":"body");t.find(".uploadify-button").css("background-color","#707070").on("click",function(){t.find(".selectbtn").trigger("click")})}}}}("undefined"==typeof jm?jQuery:jm);